<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  
  <meta name="theme-color" content="#e7f0f7" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>Calcolo Orari</title>

  <link rel="icon" type="image/png" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #e7f0f7;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .wrapper {
      display: flex;
      justify-content: center;
      gap: 30px;
      width: 100%;
      max-width: 1000px;
    }

    .container {
      background: #fff;
      padding: 30px 28px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      width: 45%;
      min-width: 300px;
      text-align: center;
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 1.25em;
      margin-bottom: 18px;
      color: #2a4d69;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
      color: #333;
      text-align: left;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #cbd6e2;
      border-radius: 8px;
      font-size: 0.95em;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      border-color: #5fa8d3;
      outline: none;
    }

    .buttons {
      display:flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 18px;
    }

    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 0.95em;
    }

    #btnCalcola, #btnCalcola2 {
      background-color: #5fa8d3;
      color: #fff;
    }

    #btnCalcola:hover, #btnCalcola2:hover {
      background-color: #4a98c2;
    }

    #btnReset, #btnReset2 {
      background-color: #f0f0f0;
      color: #333;
    }

    #btnReset:hover, #btnReset2:hover {
      background-color: #e0e0e0;
    }

    .results {
      margin-top: 22px;
      text-align: left;
      background: #f7fbff;
      border-left: 4px solid #5fa8d3;
      padding: 12px 16px;
      border-radius: 8px;
      color: #2a4d69;
      font-size: 0.95em;
      box-sizing: border-box;
    }

    .fade {
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      max-height: 0;
      overflow: hidden;
    }

    .fade.show {
      opacity: 1;
      max-height: 520px;
    }

    .warning {
      margin-top: 8px;
      color: #b33939;
      font-style: italic;
    }
  
    /* iOS/Safari ottimizzazioni */
    html, body { height: 100%; }
    body {
      padding-top: calc(20px + env(safe-area-inset-top));
      padding-bottom: calc(20px + env(safe-area-inset-bottom));
      padding-left: calc(20px + env(safe-area-inset-left));
      padding-right: calc(20px + env(safe-area-inset-right));
      -webkit-text-size-adjust: 100%;
    }
    input, select, button {
      font-size: 16px; /* evita lo zoom automatico su iOS */
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="time"]::-webkit-calendar-picker-indicator {
      opacity: 1;
    }
    select {
      background-image: linear-gradient(45deg, transparent 50%, #2a4d69 50%),
                        linear-gradient(135deg, #2a4d69 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% - 3px),
                           calc(100% - 12px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
      padding-right: 34px;
    }
    .results {
      -webkit-overflow-scrolling: touch;
      word-break: break-word;
    }
    @media (max-width: 820px) {
      .wrapper {
        flex-direction: column;
        align-items: stretch;
      }
      .container {
        width: 100%;
        max-width: 560px;
        margin: 0 auto;
      }
    }

  </style>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">

</head>
<body>
  <div class="wrapper">
    <!-- CALCOLO ORARIO DI USCITA -->
    <div class="container">
      <h1>Calcolo orario di uscita</h1>

      <label for="ingresso">Ora di ingresso:</label>
      <input type="time" id="ingresso" step="60" inputmode="numeric" autocomplete="off">

      <label for="uscita_pranzo">Ora di uscita per la pausa pranzo (opzionale):</label>
      <input type="time" id="uscita_pranzo" step="60" inputmode="numeric" autocomplete="off">

      <label for="ingresso_pranzo">Ora di ingresso dalla pausa pranzo (opzionale):</label>
      <input type="time" id="ingresso_pranzo" step="60" inputmode="numeric" autocomplete="off">

      <label for="durata_giornata">Durata della giornata lavorativa:</label>
      <select id="durata_giornata" onchange="toggleRecupero()">
        <option value="7.2">7 ore e 12 minuti (Giornata estiva)</option>
        <option value="6">6 ore (Giornata normale)</option>
        <option value="9">9 ore (Giornata di rientro)</option>
        <option value="7_buono">7 ore (Buono pasto)</option>
      </select>
      <div id="recuperoWrap">


      <label for="recupero">Recupero 30 minuti:</label>
      <select id="recupero">
        <option value="no">No</option>
        <option value="si">S√¨</option>
      </select>
      </div>

      <div class="buttons">
        <button id="btnCalcola" onclick="calcola()">Calcola</button>
        <button id="btnReset" onclick="resetCampi()">Reset</button>
      </div>

      <div id="risultati" class="results fade"></div>
    </div>

    <!-- CALCOLO ORE LAVORATE -->
    <div class="container">
      <h1>Calcolo ore lavorate</h1>

      <label for="ingresso2">Ora di ingresso:</label>
      <input type="time" id="ingresso2" step="60" inputmode="numeric" autocomplete="off">

      <label for="uscita_pranzo2">Ora di uscita per la pausa pranzo (opzionale):</label>
      <input type="time" id="uscita_pranzo2" step="60" inputmode="numeric" autocomplete="off">

      <label for="ingresso_pranzo2">Ora di ingresso dalla pausa pranzo (opzionale):</label>
      <input type="time" id="ingresso_pranzo2" step="60" inputmode="numeric" autocomplete="off">

      <label for="uscita2">Ora di uscita:</label>
      <input type="time" id="uscita2" step="60" inputmode="numeric" autocomplete="off">

      <label for="durata_giornata2">Durata della giornata lavorativa:</label>
      <select id="durata_giornata2">
        <option value="7.2">7 ore e 12 minuti (Giornata estiva)</option>
        <option value="6">6 ore (Giornata normale)</option>
        <option value="9">9 ore (Giornata di rientro)</option>
      </select>

      <div class="buttons">
        <button id="btnCalcola2" onclick="calcolaOreLavorate()">Calcola</button>
        <button id="btnReset2" onclick="resetCampi2()">Reset</button>
      </div>

      <div id="risultati2" class="results fade"></div>
    </div>
  </div>

  <script>
    // Formatta Date in HH:MM
    function makeTime(hhmm) {
      // Parsing robusto per Safari/iOS: costruisce una Date locale impostando ore/minuti
      const [h, m] = hhmm.split(":").map(Number);
      const d = new Date(2023, 6, 12, 0, 0, 0, 0); // 12 luglio 2023 (mese 0-based)
      d.setHours(h, m, 0, 0);
      return d;
    }

    function formatTime(date) {
      let h = date.getHours().toString().padStart(2, '0');
      let m = date.getMinutes().toString().padStart(2, '0');
      return `${h}:${m}`;
    }

    function fmtHMFromMinutes(mins) {
      const h = Math.floor(mins / 60);
      const m = Math.round(mins % 60);
      return `${h}h ${m}m`;
    }

    
    // Mostra/Nasconde l'opzione Recupero 30 minuti quando si seleziona "7 ore (Buono pasto)"
    function toggleRecupero() {
      const durata = document.getElementById("durata_giornata").value;
      const wrap = document.getElementById("recuperoWrap");
      const sel = document.getElementById("recupero");

      if (!wrap || !sel) return;

      if (durata === "7_buono") {
        // Nascondi e forza a "No"
        wrap.style.display = "none";
        sel.value = "no";
        sel.disabled = true;
      } else {
        wrap.style.display = "";
        sel.disabled = false;
      }
    }

// ----- MASCHERA CALCOLO USCITA -----
    function calcola() {
      const ingressoVal = document.getElementById("ingresso").value;
      const uscitaPranzoVal = document.getElementById("uscita_pranzo").value;
      const ingressoPranzoVal = document.getElementById("ingresso_pranzo").value;
      const durataGiornata = document.getElementById("durata_giornata").value;
      const recupero = document.getElementById("recupero").value;

      if (!ingressoVal) {
        alert("Inserisci almeno l'ora di ingresso per procedere!");
        return;
      }

      const orarioMinimo = "07:30";
      if (ingressoVal < orarioMinimo) {
        alert("L'Ora di ingresso deve essere successiva alle 07:29.");
        return;
      }

      const ingresso = makeTime(ingressoVal);

      // Pausa pranzo: opzionale
      let durata_pranzo = 0;
      let warningHtml = "";

      const pausaInserita = (uscitaPranzoVal && ingressoPranzoVal);

      if (pausaInserita) {
        if (ingressoPranzoVal <= uscitaPranzoVal) {
          alert("L'Ora di ingresso dalla pausa pranzo deve essere successiva all'ora di uscita per la pausa pranzo!");
          return;
        }
        const uscita_pranzo = makeTime(uscitaPranzoVal);
        const ingresso_pranzo = makeTime(ingressoPranzoVal);
        durata_pranzo = Math.round((ingresso_pranzo - uscita_pranzo) / 1000 / 60);
      } else {
        alert("Attenzione: dati della pausa pranzo non inseriti. La pausa sar√† considerata pari a 0 minuti.");
        warningHtml = `<div class="warning">‚ö†Ô∏è Pausa pranzo non indicata (calcolo con pausa = 0 minuti)</div>`;
      }

      const buonoPasto = durata_pranzo >= 30 ? "SI" : "NO";
      const iconaBuono = buonoPasto === "SI" ? "‚úÖ" : "‚ùå";
      const coloreBuono = buonoPasto === "SI" ? "green" : "red";

      let uscita;

      if (durataGiornata === "7_buono") {
        // Logica Buono Pasto: 7 ore effettive di lavoro.
        // Se la pausa non √® inserita, assumiamo lavoro continuativo: uscita = ingresso + 7h.
        const totaleOre = 7;

        if (pausaInserita) {
          const uscita_pranzo = makeTime(uscitaPranzoVal);
          const ingresso_pranzo = makeTime(ingressoPranzoVal);

          const mattina = (uscita_pranzo - ingresso) / 1000 / 60;
          const minutiRestanti = totaleOre * 60 - mattina;
          uscita = new Date(ingresso_pranzo.getTime() + minutiRestanti * 60 * 1000);

          // Se l'uscita calcolata √® minore di +1h dopo ingresso pranzo, spostala a +1h
          const uscitaMinBuono = new Date(ingresso_pranzo.getTime() + 60 * 60 * 1000);
          if (uscita < uscitaMinBuono) uscita = uscitaMinBuono;

        } else {
          uscita = new Date(ingresso.getTime() + totaleOre * 60 * 60 * 1000);
        }

      } else {
        uscita = new Date(ingresso.getTime() + parseFloat(durataGiornata) * 60 * 60 * 1000);
        uscita.setMinutes(uscita.getMinutes() + durata_pranzo);
        if (recupero === "si") uscita.setMinutes(uscita.getMinutes() + 30);
      }

      const risultati = document.getElementById("risultati");
      risultati.innerHTML = `
        <strong>Riepilogo:</strong><br>
        üïò Ingresso: ${ingressoVal}<br>
        üçΩÔ∏è Pausa pranzo: <strong style="color:black">${durata_pranzo} minuti</strong><br>
        ü•™ Buono pasto: <strong><span style="color: ${coloreBuono}">${iconaBuono} ${buonoPasto}</span></strong><br>
        ‚è±Ô∏è Durata giornata: <strong>${durataGiornata === "7_buono" ? "7 ore (Buono pasto)" : durataGiornata + " ore"}</strong><br>
        üîÅ Recupero 30 minuti: <strong>${recupero === "si" ? "S√¨" : "No"}</strong><br>
        üèÅ Orario di uscita: <strong style="color:black">${formatTime(uscita)}</strong>
        ${durataGiornata === "7_buono" ? "<br>‚öñÔ∏è Differenza: <strong style='color:green'>+1h 0m</strong>" : ""}
        ${warningHtml}
      `;
      risultati.classList.add("show");
    }

    function resetCampi() {
      document.getElementById("ingresso").value = "";
      document.getElementById("uscita_pranzo").value = "";
      document.getElementById("ingresso_pranzo").value = "";
      document.getElementById("durata_giornata").selectedIndex = 0;
      document.getElementById("recupero").selectedIndex = 0;
      const risultati = document.getElementById("risultati");
      risultati.innerHTML = "";
      risultati.classList.remove("show");
      toggleRecupero();
    }

    // ----- MASCHERA CALCOLO ORE LAVORATE -----
    function calcolaOreLavorate() {
      const ingresso = document.getElementById("ingresso2").value;
      const uscita_pranzo = document.getElementById("uscita_pranzo2").value;
      const ingresso_pranzo = document.getElementById("ingresso_pranzo2").value;
      const uscita = document.getElementById("uscita2").value;
      const durataGiornata = parseFloat(document.getElementById("durata_giornata2").value);

      // Requisiti minimi per calcolare: ingresso e uscita
      if (!ingresso || !uscita) {
        alert("Inserisci almeno ora di ingresso e ora di uscita per procedere!");
        return;
      }

      const orarioMinimo = "07:30";
      if (ingresso < orarioMinimo) {
        alert("L'Ora di ingresso deve essere successiva alle 07:29.");
        return;
      }

      const t_ingresso = makeTime(ingresso);
      const t_uscita = makeTime(uscita);

      let durata_pranzo = 0;
      let warningHtml = "";

      const pausaInserita = (uscita_pranzo && ingresso_pranzo);

      let totaleMinuti = 0;

      if (pausaInserita) {
        if (ingresso_pranzo <= uscita_pranzo) {
          alert("L'Ora di ingresso dalla pausa pranzo deve essere successiva all'ora di uscita per la pausa pranzo!");
          return;
        }

        const t_uscita_pranzo = makeTime(uscita_pranzo);
        const t_ingresso_pranzo = makeTime(ingresso_pranzo);

        // Vincolo: l'uscita deve essere almeno 1 ora dopo il rientro dalla pausa pranzo
        const uscitaMinima = new Date(t_ingresso_pranzo.getTime() + 60 * 60 * 1000);
        if (t_uscita < uscitaMinima) {
          alert("L'ora di uscita deve essere almeno 1 ora dopo l'ora di ingresso dalla pausa pranzo.");
          return;
        }

        durata_pranzo = Math.round((t_ingresso_pranzo - t_uscita_pranzo) / 1000 / 60);

        const mattina = (t_uscita_pranzo - t_ingresso) / 1000 / 60;
        const pomeriggio = (t_uscita - t_ingresso_pranzo) / 1000 / 60;
        totaleMinuti = mattina + pomeriggio;

      } else {
        alert("Attenzione: pausa pranzo non indicata. Il calcolo sar√† effettuato senza pausa (continuativo).");
        warningHtml = `<div class="warning">‚ö†Ô∏è Pausa pranzo non indicata (calcolo continuativo)</div>`;
        totaleMinuti = (t_uscita - t_ingresso) / 1000 / 60;
        durata_pranzo = 0;
      }

      // Regola buono pasto: SOLO se (lavoro >= 7 ore) E (pausa >= 30 minuti)
      const buonoPasto = (totaleMinuti >= 7 * 60 && durata_pranzo >= 30) ? "SI" : "NO";
      const iconaBuono = buonoPasto === "SI" ? "‚úÖ" : "‚ùå";
      const coloreBuono = buonoPasto === "SI" ? "green" : "red";

      const ore = Math.floor(totaleMinuti / 60);
      const minuti = Math.round(totaleMinuti % 60);

      const totaleOre = totaleMinuti / 60;
      const differenza = totaleOre - durataGiornata;
      const diffOre = Math.floor(Math.abs(differenza));
      const diffMinuti = Math.round((Math.abs(differenza) - diffOre) * 60);
      const segno = differenza >= 0 ? "+" : "-";

      let coloreDifferenza = 'black';
      if (differenza < 0) coloreDifferenza = 'red';
      if (differenza > 0) coloreDifferenza = 'green';

      const icona = differenza < 0 ? "‚ö†Ô∏è" : (differenza > 0 ? "‚úÖ" : "‚ÑπÔ∏è");

      const risultati2 = document.getElementById("risultati2");
      risultati2.innerHTML = `
        <strong>Riepilogo:</strong><br>
        üïò Ingresso: ${ingresso}<br>
        üçΩÔ∏è Pausa pranzo: <strong style="color:black">${Math.round(durata_pranzo)} minuti</strong><br>
        ü•™ Buono pasto: <strong><span style="color:${coloreBuono}">${iconaBuono} ${buonoPasto}</span></strong><br>
        üïî Uscita: ${uscita}<br>
        ‚è±Ô∏è Durata giornata: <strong style="color:black">${durataGiornata} ore</strong><br>
        ‚è±Ô∏è Ore lavorate: <strong>${ore}h ${minuti}m</strong><br>
        ‚öñÔ∏è Differenza: <strong style="color:${coloreDifferenza}">${icona} ${segno}${diffOre}h ${diffMinuti}m</strong>
        ${warningHtml}
      `;
      risultati2.classList.add("show");
    }

function resetCampi2() {
      document.getElementById("ingresso2").value = "";
      document.getElementById("uscita_pranzo2").value = "";
      document.getElementById("ingresso_pranzo2").value = "";
      document.getElementById("uscita2").value = "";
      document.getElementById("durata_giornata2").selectedIndex = 0;
      const risultati2 = document.getElementById("risultati2");
      risultati2.innerHTML = "";
      risultati2.classList.remove("show");
    }
  
    // Inizializzazione UI
    window.addEventListener('DOMContentLoaded', () => {
      toggleRecupero();
    });
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }
  </script>

</body>
</html>
